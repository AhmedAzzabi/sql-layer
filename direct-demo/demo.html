
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Akiban Direct Demo</title>
    <link rel="stylesheet" href="codemirror/lib/codemirror.css">
    <script src="codemirror/lib/codemirror.js"></script>
    <script src="codemirror/mode/javascript/javascript.js"></script>
    <link rel="stylesheet" href="codemirror/doc/docs.css">
    <style type="text/css">.CodeMirror {border: 1px solid #eee;} .CodeMirror-scroll { height: 100% }</style>
  </head>
<body>
    <h2>Akiban Direct Demo</h2>

<SCRIPT TYPE="text/javascript">
<!--

var editor;
function loadModule() {
  document.getElementById("result").value = "";
  var space = document.getElementById("space").value;
  var module = document.getElementById("module").value;
  var xmlhttp = new XMLHttpRequest();
  xmlhttp.open("PUT","../module?space=" + space + "&language=js&name=" + module + "&get=" + document.getElementById("getpost").value,false);
  xmlhttp.send(editor.getValue());
  document.getElementById("result").value=xmlhttp.responseText;
}

function removeModule() { 
  document.getElementById("result").value = "";
  var space = document.getElementById("space").value;
  var module = document.getElementById("module").value;
  var xmlhttp = xrq("DELETE","../module?space=" + space + "&name=" + module);
  xmlhttp.send();
  document.getElementById("result").value=xmlhttp.responseText;
}

function invokeGet() {
  document.getElementById("result").value = "";
  var space = document.getElementById("space").value;
  var module = document.getElementById("module").value;
  var xmlhttp = xrq("GET","../" + module + "?space=" + space);
  xmlhttp.send();
  document.getElementById("result").value=xmlhttp.responseText;
}

function invokePost() {
  document.getElementById("result").value = "";
  var space = document.getElementById("space").value;
  var module = document.getElementById("module").value;
  var xmlhttp = xrq("POST","../" + module + "?space=" + space);
  xmlhttp.send();
  document.getElementById("result").value=xmlhttp.responseText;
}

function showInterface() {
  document.getElementById("result").value = "";
  var space = document.getElementById("space").value;
  var xmlhttp = xrq("GET","../igen?space=" + space);
  xmlhttp.send();
  document.getElementById("result").value=xmlhttp.responseText;
}

function xrq(method, s) {
  s += document.getElementById("params").value;
  var href =  document.location.href;
  var c = 0;
  for (var p = href.length; --p > 0;) {
    if (href.charAt(p) == '/') {
      c++;
      if (c == 2) {
        href = href.substring(0, p);
        break;
      }
    }
  }
  href += s.substring(2);
  document.getElementById("rest").value = href;
  var x = new XMLHttpRequest();
  x.open(method, href, false);
  return x
}
//-->
</SCRIPT>

<form>
<table>
<tr><td>Space: </td><td> <input type="text" id="space" value="employees" /></td></tr>
<tr><td>Module name: </td><td><input type="text" id="module" value="example" /></td></tr>
<tr><td>Module type: </td><td> <select id="getpost">
    <option value="true">GET</option>
    <option value="false">POST</option>
 </select>
</td></tr>
</table>
<br />
<textarea id="code" name="code">
var department;
var employee;
var result = "";
for (department in Iterator(dcontext.extent.getDepartmentList())) {
  result += "Department: " + department.deptNo + " " +  department.deptName + '\n';
}
result += '\n';
for (employee in Iterator(dcontext.extent.getEmployeeList().limit("5"))) {
  result += "Employee: " + employee.empNo
    + " name: " + employee.lastName + "," + employee.firstName
    + " dob:" + employee.birthDate +'\n';
  
  var salary;
  for (salary in Iterator(employee.getSalaryList().limit(3).sort("to_date", "desc"))) {
       result += "   Salary: " + salary.salary + " from: " + salary.fromDate + " to: " + salary.toDate + '\n';
  }     
}
result;

</textarea>
<br />
<input type="button" id="interface" onClick="showInterface()" value="Show Interface" />
<input type="button" id="load" onClick="loadModule()" value="Install" />
<input type="button" id="remove" onClick="removeModule()" value="Remove" />
<input type="button" id="get"  onClick="invokeGet()" value="GET">
<input type="button" id="post" onClick="invokePost()" value="POST">
<input type="text" id="params" size="50"/>
<input type="text" id="rest" size="80"/>
</form>
<br />
<textarea rows="10" cols="100" disabled id="result">
Result...
</textArea>
    <script>
      CodeMirror.commands.autocomplete = function(cm) {
        CodeMirror.simpleHint(cm, CodeMirror.javascriptHint);
      }
        editor = CodeMirror.fromTextArea(document.getElementById("code"), {
        lineNumbers: true,
        extraKeys: {"Ctrl-Space": "autocomplete"}
      });
    </script>
  </body>
</html>
