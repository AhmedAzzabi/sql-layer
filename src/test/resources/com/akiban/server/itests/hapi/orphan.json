{
"comment" : ["See spec file: ",
    "https://spreadsheets.google.com/a/akiban.com/ccc?key=0AiGr_XWdHm0edFNSaFZwUXd5SnAtOHlDcTJyOEUzdXc",
    "Each row has 0-1 children. The structure under each customer is determined by id values.",
    "Id uses four bits as follow:",
    "- bit 0 (LSB): 1 if customer is present, 0 if not",
    "- bit 1:       1 if order is present, 0 if not",
    "- bit 2:       1 if item is present, 0 if not",
    "- bit 3 (MSB): 1 if address is present, 0 if not"
],

"setup" : {
    "processors_default" : [ "scanrows" ],
    "schema" : "coia",
    "tables" : [
        [ "customer",
            "cid int key"
        ],

        [ "orders",
            "oid int key",
            "cid int",
            "CONSTRAINT __akiban_o FOREIGN KEY __akiban_o (cid) REFERENCES customer(cid)"
        ],

        [ "item",
            "iid int key",
            "oid int",
            "CONSTRAINT __akiban_i FOREIGN KEY __akiban_i (oid) REFERENCES orders(oid)"
        ],

        [ "address",
            "aid int key",
            "cid int",
            "CONSTRAINT __akiban_a FOREIGN KEY __akiban_a (cid) REFERENCES customer(cid)"
        ]
    ],
    "write_rows" : {
        "customer" : [
            [1],
            [3],
            [5],
            [7],
            [9],
            [11],
            [13],
            [15]
        ],
        "orders" : [
            [2, null],
            [3, 3],
            [6, null],
            [7, 7],
            [10, null],
            [11, 11],
            [14, null],
            [15, 15]
        ],
        "item" : [
            [4, null],
            [5, null],
            [6, 6],
            [7, 7],
            [12, null],
            [13, null],
            [14, 14],
            [15, 15]
        ],
        "address" : [
            [8, null],
            [9, 9],
            [10, null],
            [11, 11],
            [12, null],
            [13, 13],
            [14, null],
            [15, 15]
        ]
    }
},

"tests" : {
    "coia (15)" : {
        "get" : "coia:customer:cid=15",
        "expect result" :
        {
            "@customer" :
            [
                {
                    "cid" : 15,
                    "@orders" :
                    [
                        {
                            "oid" : 15,
                            "cid" : 15,
                            "@item" :
                            [
                                {
                                    "iid" : 15,
                                    "oid" : 15
                                }
                            ]
                        }
                    ],
                    "@address" :
                    [
                        {
                            "aid" : 15,
                            "cid" : 15
                        }
                    ]
                }
            ]
        }
    }
}

}
