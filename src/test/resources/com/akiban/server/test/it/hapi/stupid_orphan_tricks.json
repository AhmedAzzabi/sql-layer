{
"comment" : ["See spec file: ",
    "https://spreadsheets.google.com/a/akiban.com/ccc?key=0AiGr_XWdHm0edFNSaFZwUXd5SnAtOHlDcTJyOEUzdXc",
    "wrong parent test: See http://akibainc.onconfluence.com/display/db/Determining+whether+a+row+is+an+orphan"
],

"setup" : {
    "processors_default" : [ "scanrows" ],
    "schema" : "coi",
    "tables" : [
        [ "customer",
            "cid int not null",
            "primary key(cid)"
        ],

        [ "orders",
            "cid int not null",
            "oid int not null",
            "primary key(cid, oid)",
            "GROUPING FOREIGN KEY (cid) REFERENCES customer(cid)"
        ],

        [ "item",
            "cid int not null",
            "oid int not null",
            "iid int not null",
            "primary key(cid, oid, iid)",
            "GROUPING FOREIGN KEY (cid, oid) REFERENCES orders(cid, oid)"
        ],
    ],
    "write_rows" : {
        "customer" : [
            [1],
            [3]
        ],
        "orders" : [
            [1, 10]
        ],
        "item" : [
            [1, 99, 100],
            [2, 20, 200],
            [2, 20, 201]
        ]
    }
},

"tests" : {
    "wrong parent" : {
        "get" : "coi:customer:cid>=1",
        "expect result" :
        {
            "@customer" :
            [
                {
                    "cid" : 1,
                    "@orders" :
                    [
                        {
                            "cid" : 1,
                            "oid" : 10,
                            "@item" : []
                        },
                        {
                            "cid" : null,
                            "oid" : null,
                            "@item" :
                            [
                                {
                                    "cid" : 1,
                                    "oid" : 99,
                                    "iid" : 100
                                }
                            ]
                        }
                    ]
                },
                {
                    "cid" : 3,
                    "@orders" : []
                }
            ]
        }
    }
}

}
