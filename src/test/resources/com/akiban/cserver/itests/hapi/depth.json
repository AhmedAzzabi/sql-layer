{
"comment" : ["See spec file: ",
    "https://spreadsheets.google.com/a/akiban.com/ccc?key=0AiGr_XWdHm0edFNSaFZwUXd5SnAtOHlDcTJyOEUzdXc",
    "This test plan has a couple modifications from that spec:",
    "   - no orphan rows",
    "   - giving customer id=9 an address"
],

"setup" : {
    "schema" : "coi",
    "tables" : [
        [ "customer",
            "cid int key",
            "name varchar(32)"
        ],
                        
        [ "orders",
            "oid int key",
            "c_id int",
            "when varchar(10)",
            "CONSTRAINT __akiban_o FOREIGN KEY __akiban_o (c_id) REFERENCES customer(cid)"
        ],
                        
        [ "item",
            "iid int key",
            "o_id int",
            "sku int",
            "CONSTRAINT __akiban_i FOREIGN KEY __akiban_i (o_id) REFERENCES orders(oid)"
        ],

        [ "address",
            "aid int key",
            "c_id int",
            "street varchar(32)",
            "CONSTRAINT __akiban_a FOREIGN KEY __akiban_a (c_id) REFERENCES customer(cid)"
        ]
    ],
    "write_rows" : {
        "customer"  : [ [11, "Alpha"],
                        [19, "Bravo"]
        ],
        "orders"    : [ [21, 11, "1/1/2001"],
                        [22, 11, "2/2/2002"]
        ],
        "item"      : [ [31, 21, 1111]
        ],
        "address"   : [ [41, 11, "500 Harrison"],
                        [42, 19, "1 Akiban Way"]
        ]
    }
},

"tests" : {
    "from root" : {
        "get"           : "coi:customer:cid=1",
        "expect result" :
        {
            "customer" :
            [
                {
                    "data"  :
                    {   "cid"   : 11,
                        "name"  : "Alpha"
                    },
                    "children" :
                    {
                        "orders" :
                        [
                            {
                                "data" :
                                {
                                    "oid"   : 21,
                                    "c_id"  : 11,
                                    "when"  : "1/1/2001"
                                },
                                "children" :
                                {
                                    "item" : [
                                        {
                                            "data" :
                                            {
                                                "iid"   : 31,
                                                "o_id"  : 21,
                                                "sku"   : 1111
                                            }
                                        }
                                    ]
                                }
                            },
                            {
                                "data" :
                                {
                                    "oid"   : 22,
                                    "c_id"  : 11,
                                    "when"  : "2/2/2002"
                                },
                                "children" :
                                {
                                    "item" : []
                                }
                            }
                        ],
                        "address" :
                        [
                            {
                                "data" :
                                {
                                    "aid"   : 41,
                                    "c_id"  : 11,
                                    "street": "500 Harrison"
                                },
                                "children" : {}
                            }
                        ]
                    }
                }
            ]
        }
    },

    "from child" : {
        "get"           : "coi:order:oid=2",
        "expect result" :
        {
            "customer" : []
        }
    },

    "from predicate's child" : {
        "get"           : "coi:orders:(customer)id=11",
        "expect error"  : "PREDICATE_IS_PARENT"
    }
}

}
