# Test the SUM aggregate function

---
- Include: all-types-schema.yaml

# Test sum with no rows => null
---
- Statement: SELECT sum(bigint_field), sum(decimal_field), sum(double_field),
    sum(float_field), sum(integer_field), sum(numeric_field),
    sum(smallint_field) FROM all_types
- output: [[null, null, null, null, null, null, null]]

# Test sum with inserted rows

---
- Statement: INSERT INTO all_types
    (bigint_field, decimal_field, double_field, float_field, integer_field,
     numeric_field, smallint_field)
    VALUES
    (1, 2.0, 3.0, 4.0, 5, 6.0, 7)
---
- Statement: SELECT bigint_field, decimal_field, double_field, float_field,
     integer_field, numeric_field, smallint_field FROM all_types
- output: [[1, 2.0, 3.0, 4.0, 5, 6.0, 7]]

---
- Statement: SELECT sum(bigint_field), sum(decimal_field), sum(double_field),
    sum(float_field), sum(integer_field), sum(numeric_field),
    sum(smallint_field) FROM all_types
- output: [[1, 2.0, 3.0, 4.0, 5, 6.0, 7]]

# Insert a row of nulls
---
- Statement: INSERT INTO all_types
    (bigint_field, decimal_field, double_field, float_field, integer_field,
     numeric_field, smallint_field)
    VALUES
    (null, null, null, null, null, null, null)
---
- Statement: SELECT sum(bigint_field), sum(decimal_field), sum(double_field),
    sum(float_field), sum(integer_field), sum(numeric_field),
    sum(smallint_field) FROM all_types
- output: [[1, 2.0, 3.0, 4.0, 5, 6.0, 7]]

---
- Statement: INSERT INTO all_types
    (bigint_field, decimal_field, double_field, float_field, integer_field,
     numeric_field, smallint_field)
    VALUES
    (1, 2.0, 3.0, 4.0, 5, 6.0, 7)
---
- Statement: SELECT sum(bigint_field), sum(decimal_field), sum(double_field),
    sum(float_field), sum(integer_field), sum(numeric_field),
    sum(smallint_field) FROM all_types
- output: [[2, 4.0, 6.0, 8.0, 10, 12.0, 14]]

---
- Statement: INSERT INTO all_types
    (bigint_field, decimal_field, double_field, float_field, integer_field,
     numeric_field, smallint_field)
    VALUES
    (-4, -8.0, -12.0, -16.0, -20, -24.0, -28)
---
- Statement: SELECT sum(bigint_field), sum(decimal_field), sum(double_field),
    sum(float_field), sum(integer_field), sum(numeric_field),
    sum(smallint_field) FROM all_types
- output: [[-2, -4.0, -6.0, -8.0, -10, -12.0, -14]]

---
- Statement: INSERT INTO all_types
    (bigint_field, decimal_field, double_field, float_field, integer_field,
     numeric_field, smallint_field)
    VALUES
    (2, 4.0, 6.0, 8.0, 10, 12.0, 14)
---
- Statement: SELECT sum(bigint_field), sum(decimal_field), sum(double_field),
    sum(float_field), sum(integer_field), sum(numeric_field),
    sum(smallint_field) FROM all_types
- output: [[0, 0.0, 0.0, 0.0, 0, 0.0, 0]]

---
- Statement: DELETE from all_types

# Test integer overflow and underflow
---
- Statement: INSERT INTO all_types (bigint_field) VALUES (9223372036854775807)
---
- Statement: SELECT sum(bigint_field) FROM all_types
- output: [[9223372036854775807]]
---
- Statement: INSERT INTO all_types (bigint_field) VALUES (1)
---
- Statement: SELECT sum(bigint_field) FROM all_types
- error: [55004]
---
- Statement: DELETE FROM all_types
---
- Statement: INSERT INTO all_types (bigint_field) VALUES (-9223372036854775808)
---
- Statement: SELECT sum(bigint_field) FROM all_types
- output: [[-9223372036854775808]]
---
- Statement: INSERT INTO all_types (bigint_field) VALUES (-1)
---
- Statement: SELECT sum(bigint_field) FROM all_types
- error: [55004]

# Test double overflow
---
- Statement: INSERT INTO all_types (double_field) VALUES (1.7976931348623157E308)
---
- Statement: SELECT sum(double_field) FROM all_types
- output: [[1.7976931348623157E308]]
---
- Statement: INSERT INTO all_types (double_field) VALUES (1.7976931348623157E308)
---
- Statement: SELECT sum(double_field) FROM all_types
- error: [55004]
---
- Statement: DELETE FROM all_types
---
- Statement: INSERT INTO all_types (double_field) VALUES
    (-1.7976931348623157E308)
---
- Statement: SELECT sum(double_field) FROM all_types
- output: [[-1.7976931348623157E308]]
---
- Statement: INSERT INTO all_types (double_field) VALUES
    (-1.7976931348623157E308)
---
- Statement: SELECT sum(double_field) FROM all_types
- error: [55004]
---
- Statement: DELETE FROM all_types
---
- Statement: INSERT INTO all_types (double_field) VALUES ('Infinity')
---
- Statement: SELECT sum(double_field) FROM all_types
- output: [[Infinity]]
---
- Statement: INSERT INTO all_types (double_field) VALUES ('33')
---
- Statement: SELECT sum(double_field) FROM all_types
- output: [[Infinity]]
---
- Statement: DELETE FROM all_types
---
- Statement: INSERT INTO all_types (double_field) VALUES ('-Infinity')
---
- Statement: SELECT sum(double_field) FROM all_types
- output: [[-Infinity]]
---
- Statement: INSERT INTO all_types (double_field) VALUES ('-33')
---
- Statement: SELECT sum(double_field) FROM all_types
- output: [[-Infinity]]

# Test float overflow
---
- Statement: INSERT INTO all_types (float_field) VALUES (3.4028234663852886E38)
---
- Statement: SELECT sum(float_field) FROM all_types
- output: [[3.4028234663852886E38]]
---
- Statement: INSERT INTO all_types (float_field) VALUES (3.4028234663852886E38)
---
- Statement: SELECT sum(float_field) FROM all_types
#- output: [[Infinity]]
- output: [[6.805646932770577E38]]
---
- Statement: DELETE FROM all_types
---
- Statement: INSERT INTO all_types (float_field) VALUES (-3.4028234663852886E38)
---
- Statement: SELECT sum(float_field) FROM all_types
- output: [[-3.4028234663852886E38]]
---
- Statement: INSERT INTO all_types (float_field) VALUES (-3.4028234663852886E38)
---
- Statement: SELECT sum(float_field) FROM all_types
- output: [[-6.805646932770577E38]]
---
- Statement: DELETE FROM all_types
---
- Statement: INSERT INTO all_types (float_field) VALUES ('Infinity')
---
- Statement: SELECT sum(float_field) FROM all_types
- output: [[Infinity]]
---
- Statement: INSERT INTO all_types (float_field) VALUES ('33')
---
- Statement: SELECT sum(float_field) FROM all_types
- output: [[Infinity]]
---
- Statement: DELETE FROM all_types
---
- Statement: INSERT INTO all_types (float_field) VALUES ('-Infinity')
---
- Statement: SELECT sum(float_field) FROM all_types
- output: [[-Infinity]]
---
- Statement: INSERT INTO all_types (float_field) VALUES ('-33')
---
- Statement: SELECT sum(float_field) FROM all_types
- output: [[-Infinity]]

---
- Statement: DELETE FROM all_types

# Test NaN
---
- Statement: INSERT INTO all_types (double_field, float_field)
    VALUES (1.0, 1.0)
---
- Statement: INSERT INTO all_types (double_field, float_field)
    VALUES ('Infinity', 'Infinity')
---
- Statement: SELECT sum(double_field), sum(float_field) FROM all_types
- output: [[Infinity, Infinity]]
---
- Statement: INSERT INTO all_types (double_field, float_field)
    VALUES ('-Infinity', '-Infinity')
---
- Statement: SELECT sum(double_field), sum(float_field) FROM all_types
- output: [[NaN, NaN]]
---
- Statement: DELETE FROM all_types
---
- Statement: INSERT INTO all_types (double_field, float_field)
    VALUES ('Infinity', 'Infinity'), ('NaN', 'NaN')
---
- Statement: SELECT sum(double_field), sum(float_field) FROM all_types
- output: [[NaN, NaN]]

...
