# Test DML related to foreign key constraints
---
- CreateTable: p (id INT PRIMARY KEY NOT NULL, n INT NOT NULL, UNIQUE(n))
---
- CreateTable: c (id INT PRIMARY KEY NOT NULL, m INT, FOREIGN KEY(m) REFERENCES p(n))
---
- Statement: INSERT INTO p VALUES(1, 100), (2, 200), (3, 300), (4, 400)
---
- Statement: INSERT INTO c VALUES(10, 100), (40, 400)
---
- Statement: INSERT INTO c VALUES(50, 500)
- error: [23503, 'ERROR: Cannot insert into table `test`.`c` with m = 500 due to foreign key constraint `__fk_1` since no matching row exists in `test`.`p`']
---
- Statement: TRUNCATE TABLE p
- error: [23504, 'ERROR: Cannot truncate table `test`.`p` with n = 100 due to foreign key constraint `__fk_1` on `test`.`c`']
---
- Statement: DELETE FROM p WHERE id = 3
---
- Statement: DELETE FROM p WHERE id = 4
- error: [23504, 'ERROR: Cannot delete from table `test`.`p` with n = 400 due to foreign key constraint `__fk_1` on `test`.`c`']
---
- Statement: UPDATE p SET n = 500 WHERE id = 4
- error: [23504, 'ERROR: Cannot update table `test`.`p` with n = 400 due to foreign key constraint `__fk_1` on `test`.`c`']
---
- Statement: UPDATE c SET m = 500 WHERE id = 40
- error: [23503, 'ERROR: Cannot update table `test`.`c` with m = 500 due to foreign key constraint `__fk_1` since no matching row exists in `test`.`p`']
---
- Statement: UPDATE c SET m = 200 WHERE id = 40
---
- Statement: INSERT INTO c VALUES(20, 400),(30,NULL)
---
- Statement: SELECT * FROM c ORDER BY id
- output: [[10, 100],[20,400],[30,null],[40,200]]
---
- Statement: ALTER TABLE c DROP FOREIGN KEY
---
- Statement: ALTER TABLE c ADD FOREIGN KEY(m) REFERENCES p(n) ON DELETE SET NULL
---
- Statement: DELETE FROM p WHERE id = 1
---
- Statement: SELECT * FROM c ORDER BY id
- output: [[10, null],[20,400],[30,null],[40,200]]
---
- Statement: ALTER TABLE c DROP FOREIGN KEY
---
- Statement: ALTER TABLE c ADD FOREIGN KEY(m) REFERENCES p(n) ON DELETE CASCADE
---
- Statement: DELETE FROM p WHERE id = 2
---
- Statement: SELECT * FROM c ORDER BY id
- output: [[10, null],[20,400],[30,null]]
---
- Statement: TRUNCATE TABLE p
---
- Statement: SELECT * FROM c ORDER BY id
- output: [[10, null],[30,null]]
---
# For dropAllTables(), whose order isn't predictable.
- Statement: ALTER TABLE c DROP FOREIGN KEY
...