<?xml version="1.0" encoding="UTF-8"?>
<project name="Akiban Server App Builder" default="bundle" basedir="..">
    <!--
         Oracle docs:
         http://docs.oracle.com/javase/7/docs/technotes/guides/jweb/packagingAppsForMac.html

         appbundler details:
         http://java.net/downloads/appbundler/appbundler.html for details
    -->

    <property environment="env" />

    <taskdef name="bundleapp"
             classname="com.oracle.appbundler.AppBundlerTask"
             classpath="target/appbundler-1.0.jar" />

    <target name="bundle">
        <!-- All attributes, except outputdirectory, correspond to Info.plist entires -->
        <bundleapp outputdirectory="target/" 
                   name="Akiban Server"
                   displayname="Akiban Server"
                   identifier="com.akiban.server"
                   icon="macosx/Akiban Server.icns"
                   shortversion="1.4.5"
                   signature="????"
                   copyright="Â© 2009-2013 Akiban Technologies, Inc."
                   applicationCategory="public.app-category.developer-tools"
                   mainclassname="com.akiban.server.service.ui.AkServerWithSwingConsole">

            <!-- Include the compile time JRE in the bundle. Bloats bundle by 136M. -->
            <!-- <runtime dir="${env.JAVA_HOME}" /> -->

            <!-- Files are copied into bundle and set as classpath -->
            <classpath dir="target/" includes="akiban-server-1.4.5-SNAPSHOT.jar,dependency/*.jar" />
            
            <!-- option-s are passed to the JVM -->
            <option value="-ea" />
            <option value="-XX:+UseThreadPriorities" />
            <option value="-XX:ThreadPriorityPolicy=42" />
            <option value="-Xms1024m" />
            <option value="-Xmx1024m" />
            <option value="-XX:+UseParNewGC" />
            <option value="-Dcom.sun.management.jmxremote.port=8082" />
            <option value="-Dcom.sun.management.jmxremote.ssl=false" />
            <option value="-Dcom.sun.management.jmxremote.authenticate=false" />
            <!--
            <option value="-XX:+HeapDumpOnOutOfMemoryError" />
            <option value="-Xrunjdwp:transport=dt_socket,address=8000,suspend=n,server=y" />
            <option value="-Djava.net.preferIPv4Stack=true" />
            -->
            <option value="-Dapple.laf.useScreenMenuBar=true" />
            <option value="-Dlog4j.configuration=file:$APP_ROOT/Contents/Resources/config/log4j.properties" />
            <option value="-Dakserver.config_dir=$APP_ROOT/Contents/Resources" />
            <option value="-Dservices.config=$APP_ROOT/Contents/Resources/config/services-config.yaml" />
            <option value="-Dakiban.home=$APP_ROOT/Contents/Resources" />

            <!-- The display name is suppose to influence the About menu name, but doesn't. This does. -->
            <option value="-Xdock:name=Akiban Server" />
        </bundleapp>
    </target>
</project>
